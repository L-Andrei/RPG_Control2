<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>Cadastro/Login</title>
</head>
<body>
    <h1>Cadastro / Login</h1>

    <div id="mensagem" style="color: red; margin-bottom: 1em;"></div>

    <form id="formLoginCadastro">
        <label for="email">Email:</label><br>
        <input type="email" id="email" name="email" required /><br><br>

        <label for="senha">Senha:</label><br>
        <input type="password" id="senha" name="senha" required /><br><br>

        <label>
            <input type="radio" name="acao" value="cadastro" checked /> Cadastro
        </label>
        <label>
            <input type="radio" name="acao" value="login" /> Login
        </label><br><br>

        <button type="submit">Enviar</button>
    </form>

    <script>
        function setCookie(name, value, days) {
            const expires = new Date(Date.now() + days * 864e5).toUTCString();
            document.cookie = name + '=' + encodeURIComponent(value) + '; expires=' + expires + '; path=/';
        }

        function getCookie(name) {
            return document.cookie.split('; ').reduce((r, v) => {
                const parts = v.split('=');
                return parts[0] === name ? decodeURIComponent(parts[1]) : r
            }, '');
        }

        let backendUrl = getCookie('backendUrl');

        if (!backendUrl) {
            backendUrl = prompt('Informe a URL do backend (ex: http://localhost:5000)');
            if (backendUrl) {
                setCookie('backendUrl', backendUrl, 7); // expira em 7 dias
            } else {
                alert('URL do backend não informada. A página não funcionará corretamente.');
            }
        }

        const form = document.getElementById('formLoginCadastro');
        const mensagemDiv = document.getElementById('mensagem');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            mensagemDiv.textContent = ''; // limpa mensagem

            const email = form.email.value.trim();
            const senha = form.senha.value.trim();
            const acao = form.acao.value; // "cadastro" ou "login"

            if (!email || !senha) {
                mensagemDiv.textContent = 'Email e senha são obrigatórios.';
                return;
            }

            try {
                const response = await fetch(`${backendUrl}/${acao}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, senha })
                });

                const data = await response.json();

                if (!response.ok) {
                    mensagemDiv.style.color = 'red';
                    mensagemDiv.textContent = data.error || 'Erro desconhecido';
                } else {
                    mensagemDiv.style.color = 'green';
                    mensagemDiv.textContent = data.message || 'Sucesso!';
                }
            } catch (error) {
                mensagemDiv.style.color = 'red';
                mensagemDiv.textContent = 'Erro na conexão com o servidor.';
            }
        });
    </script>
</body>
</html>
